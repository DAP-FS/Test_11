========================================================================
Apriori Algorithm : Friendly Session
========================================================================

.. note::
   **Overview** üéì

   Think of this lesson as a friendly guide. We'll walk together, step by step, through
   the Apriori Algorithm. No rushing, no confusion‚Äîjust clear explanations with real shopping examples.

   **What you'll learn:**

   - How to find patterns in shopping data (like which products are bought together)
   - Three important measurements: Support, Confidence, and Lift
   - How to use the Apriori Algorithm step by step
   - Practice with real exercises to test your understanding

------------------------------------------------------------------------

üìö Part 1: Understanding the Basics
========================================================================

Why Should You Care About This?
------------------------------

**Real-Life Story:**

Imagine you manage an online store. Every day, thousands of customers buy products.
You notice something interesting:

- When people buy **Smartphones**, they also buy **Chargers**
- When they buy **Laptops**, they often add a **Mouse**
- **Earphones** and **Cases** are frequently purchased together

**Question:** Wouldn't it be amazing if you could discover these patterns automatically?

**Answer:** That's exactly what the Apriori Algorithm does!

**Business Benefits:**

‚úÖ **Better Product Placement** ‚Äî Put related items near each other

‚úÖ **Smart Recommendations** ‚Äî "Customers who bought X also bought Y"

‚úÖ **Bundle Offers** ‚Äî Create discount packages (Smartphone + Charger combo)

‚úÖ **Inventory Planning** ‚Äî Stock items that sell together

**Real Companies Using This:**

- **Amazon**, **Netflix**, **Spotify**, **Grocery Stores**

.. important::
   The Apriori Algorithm helps businesses understand **customer behavior patterns**
   to make smarter decisions!

------------------------------------------------------------------------

Key Terms You Must Know
-----------------------

.. glossary::

   Transaction
      A single shopping event where a customer buys one or more items.
         Example: Customer buys {Smartphone, Charger, Earphones} in one purchase = 1 transaction

   Itemset
      A group of one or more items.
         Example: {Smartphone} is a 1-itemset. {Smartphone, Charger} is a 2-itemset.

   Frequent Itemset
      A group of items that appears **often enough** in your data (meets minimum support).
         Example: If {Smartphone, Charger} appears in 50% of transactions, it's frequent!

   Association Rule
      An **"if-then"** pattern showing relationships between items.
         Example: **IF** customer buys Smartphone **THEN** they also buy Charger
         Written as: {Smartphone} ‚Üí {Charger}

   Support
      **"How popular is this item/itemset?"**
      Measures how often an item appears in all transactions.

   Confidence
      **"How reliable is this rule?"**
      If someone buys Item A, how likely are they to also buy Item B?

   Lift
      **"Is this a real pattern or just coincidence?"**
      Tells us if items truly influence each other.

.. tip::
   **Memory Tip:** Support = Popular, Confidence = Reliable, Lift = Real connection

------------------------------------------------------------------------

üìä Part 2: Meet Your Practice Dataset
========================================================================

Our Example: Online Shopping Transactions
-----------------------------------------

.. list-table:: **Transaction Database**
   :header-rows: 1
   :widths: 20 60

   * - **Transaction ID**
     - **Items Purchased**
   * - T1
     - {Smartphone, Charger, Earphones}
   * - T2
     - {Smartphone, Charger}
   * - T3
     - {Smartphone, Case, Earphones}
   * - T4
     - {Charger, Powerbank}
   * - T5
     - {Smartphone, Charger, Powerbank}

**Dataset Summary:**

- **Total Transactions:** 5
- **Total Unique Items:** 5 (Smartphone, Charger, Earphones, Case, Powerbank)
- **Goal:** Find which items are frequently bought together

.. note::
   **For this lesson:** We'll use **Minimum Support = 40%** (item must appear in at least 2 out of 5 transactions)

------------------------------------------------------------------------

Quick Analysis: What Do You Notice?
-----------------------------------

**Count each item:**

- **Smartphone:** 4 times (T1, T2, T3, T5) = **80%**
- **Charger:** 4 times (T1, T2, T4, T5) = **80%**
- **Earphones:** 2 times (T1, T3) = **40%**
- **Powerbank:** 2 times (T4, T5) = **40%**
- **Case:** 1 time (T3) = **20%**

**First Observation:** Case is not popular (only 20%). We might remove it!

------------------------------------------------------------------------

üß† Part 3: Core Concepts Explained
========================================================================

The Apriori Principle (Most Important Idea!)
--------------------------------------------

**Simple Analogy:**  
If a tower of **3 blocks** is strong, its pieces (2 blocks, 1 block) must also be strong.  
If a 3-block tower is weak, any bigger tower using those blocks will also be weak.

**Apriori Principle (Official):**
   *"If an itemset is frequent, then all of its subsets must also be frequent."*
   *"If an itemset is infrequent, all its supersets must also be infrequent."*

**Why This Matters:**  
Saves lots of time and avoids checking impossible combinations!

------------------------------------------------------------------------

The Three Magic Formulas
------------------------

Formula 1: Support (Popularity)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. math::
   \text{Support}(A) = \frac{\text{Number of transactions containing } A}{\text{Total number of transactions}}

*Example* (Smartphone):

.. math::
   \text{Support}(\text{Smartphone}) = \frac{4}{5} = 0.8 = 80\%

Formula 2: Confidence (Reliability)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. math::
   \text{Confidence}(A \rightarrow B) = \frac{\text{Support}(A \cup B)}{\text{Support}(A)}

*Example* ({Smartphone} ‚Üí {Charger}):

.. math::
   \text{Confidence}(\text{Smartphone} \rightarrow \text{Charger}) = \frac{3}{4} = 0.75 = 75\%

Formula 3: Lift (Real Connection)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. math::
   \text{Lift}(A \rightarrow B) = \frac{\text{Support}(A \cup B)}{\text{Support}(A) \times \text{Support}(B)}

*Example* ({Smartphone} ‚Üí {Charger}):

.. math::
   \text{Lift}(\text{Smartphone} \rightarrow \text{Charger}) = \frac{0.6}{0.8 \times 0.8} = 0.9375

**Interpretation:** Lift < 1 suggests not a strong association. (We'll fix and explain this in depth below!)

------------------------------------------------------------------------

üìã Part 4: The Algorithm Step-by-Step
========================================================================

Overview: How Apriori Works
---------------------------

**Big Steps:**
1. **Start with individual items** ‚Üí Count each
2. **Remove unpopular items**
3. **Create pairs** from survivors
4. **Repeat for larger groups**
5. **Generate rules** for recommendations

Let's try with our shopping data!

------------------------------------------------------------------------

Step 1: Scan Database and Count Items
-------------------------------------

.. list-table:: **C‚ÇÅ: All Single Items**
   :header-rows: 1
   :widths: 30 25 25 20

   * - **Item**
     - **Transactions**
     - **Support Count**
     - **Support %**
   * - {Smartphone}
     - T1, T2, T3, T5
     - 4
     - 80%
   * - {Charger}
     - T1, T2, T4, T5
     - 4
     - 80%
   * - {Earphones}
     - T1, T3
     - 2
     - 40%
   * - {Powerbank}
     - T4, T5
     - 2
     - 40%
   * - {Case}
     - T3
     - 1
     - 20%

**Apply Minimum Support Filter (40%):**

.. attention::
   ‚ùå Remove: {Case} (20%) ‚Äî Not frequent enough

Remaining: Smartphone, Charger, Earphones, Powerbank

------------------------------------------------------------------------

Step 2: Generate Pairs (2-Itemsets)
-----------------------------------

**Possible Pairs:** {Smartphone, Charger}, {Smartphone, Earphones}, {Smartphone, Powerbank}, {Charger, Earphones}, {Charger, Powerbank}, {Earphones, Powerbank}

.. list-table:: **C‚ÇÇ: Candidate 2-Itemsets**
   :header-rows: 1
   :widths: 35 30 20 15

   * - **Itemset**
     - **Transactions**
     - **Support Count**
     - **Support %**
   * - {Smartphone, Charger}
     - T1, T2, T5
     - 3
     - 60%
   * - {Smartphone, Earphones}
     - T1, T3
     - 2
     - 40%
   * - {Smartphone, Powerbank}
     - T5
     - 1
     - 20%
   * - {Charger, Earphones}
     - T1
     - 1
     - 20%
   * - {Charger, Powerbank}
     - T4, T5
     - 2
     - 40%
   * - {Earphones, Powerbank}
     - (none)
     - 0
     - 0%

**Apply Minimum Support Filter (40%):**

.. attention::
   ‚ùå Remove: {Smartphone, Powerbank} (20%)
   ‚ùå Remove: {Charger, Earphones} (20%)
   ‚ùå Remove: {Earphones, Powerbank} (0%)

Remaining pairs: {Smartphone, Charger}, {Smartphone, Earphones}, {Charger, Powerbank}

------------------------------------------------------------------------

Step 3: Try to Create Triplets (3-Itemsets)
-------------------------------------------

Check all pairs ‚Äî none can make a valid 3-itemset, since not all their pairs are frequent (fails Apriori Principle).

.. note::
   **No frequent 3-itemsets can be formed.**
   **Algorithm stops here!**

------------------------------------------------------------------------

Step 4: Generate Association Rules (with Support, Confidence, Lift)
-------------------------------------------------------------------

Set Minimum Confidence = 60%

.. list-table:: **Frequent Pairs and Support**
   :header-rows: 1
   :widths: 40 30 30

   * - **Itemset**
     - **Support Count**
     - **Support %**
   * - {Smartphone, Charger}
     - 3
     - 60%
   * - {Smartphone, Earphones}
     - 2
     - 40%
   * - {Charger, Powerbank}
     - 2
     - 40%

**Now analyze each pair for possible rules:**

- {Smartphone} ‚Üí {Charger}:
   - Support = 60%
   - Confidence = 3/4 = 75%
   - Lift = 0.6 / (0.8 √ó 0.8) = 0.9375

- {Charger} ‚Üí {Smartphone}:
   - Support = 60%
   - Confidence = 3/4 = 75%
   - Lift = 0.6 / (0.8 √ó 0.8) = 0.9375

- {Earphones} ‚Üí {Smartphone}:
   - Support = 40%
   - Confidence = 2/2 = 100%
   - Lift = 0.4 / (0.4 √ó 0.8) = 1.25

- {Powerbank} ‚Üí {Charger}:
   - Support = 40%
   - Confidence = 2/2 = 100%
   - Lift = 0.4 / (0.4 √ó 0.8) = 1.25

**Final Valid Rules:**

.. list-table:: **Accepted Association Rules (with Lift)**
   :header-rows: 1
   :widths: 28 11 13 10 36

   * - **Rule**
     - **Support**
     - **Confidence**
     - **Lift**
     - **Business Action**
   * - {Smartphone} ‚Üí {Charger}
     - 60%
     - 75%
     - 0.94
     - Recommend chargers to smartphone buyers (confidence is strong, but lift shows association is no stronger than chance)
   * - {Charger} ‚Üí {Smartphone}
     - 60%
     - 75%
     - 0.94
     - Recommend smartphones to charger buyers
   * - {Earphones} ‚Üí {Smartphone}
     - 40%
     - 100%
     - 1.25
     - Bundle earphones with smartphones (**lift > 1: strong bundling**)
   * - {Powerbank} ‚Üí {Charger}
     - 40%
     - 100%
     - 1.25
     - Bundle powerbanks with chargers (**lift > 1: strong bundling**)

.. important::
   **Key:** Use support for popularity, confidence for reliability, and **lift** to find true bonds.  
   Lift greater than 1 signals real, useful connections for business action!

------------------------------------------------------------------------

Visual Summary: The Complete Process
-------------------------------------

.. code-block:: text

   üì¶ APRIORI ALGORITHM FLOW
   Level 0: Input data
   ‚îî‚îÄ 5 Transactions with 5 Items
                 ‚Üì
   Level 1: Individual Items (L‚ÇÅ)
   ‚îî‚îÄ Smartphone (80%) | Charger (80%) | Earphones (40%) | Powerbank (40%)
         ‚úó Case removed (< 40%)
                 ‚Üì
   Level 2: Item Pairs (L‚ÇÇ)
   ‚îî‚îÄ {Smartphone, Charger} (60%), {Smartphone, Earphones} (40%), {Charger, Powerbank}(40%)
         ‚úó 3 other pairs removed (< 40%)
                 ‚Üì
   Level 3: Triplets
   ‚îî‚îÄ (None Found) ‚Äî Algorithm Stops
                 ‚Üì
   Association Rules (Confidence ‚â• 60%)
   ‚îî‚îÄ {Smartphone} ‚Üí {Charger}  [75% conf, 0.94 lift]
      {Charger} ‚Üí {Smartphone}  [75%, 0.94]
      {Earphones} ‚Üí {Smartphone}  [100%, 1.25]
      {Powerbank} ‚Üí {Charger}    [100%, 1.25]

------------------------------------------------------------------------

üéØ Part 5: Practice Exercises
========================================================================

.. attention::
   **Learning by Doing!**
   Try each exercise yourself. Click "Show Solution" to check.

Exercise 1: Calculate Support (Beginner)
----------------------------------------

**Given Data:**

.. list-table::
   :header-rows: 1

   * - **Transaction**
     - **Items**
   * - T1
     - {Laptop, Mouse, Keyboard}
   * - T2
     - {Laptop, Mouse}
   * - T3
     - {Mouse, Keyboard, USB}
   * - T4
     - {Laptop, Keyboard}
   * - T5
     - {Mouse, USB}

**Question:** Calculate Support for:
  1. {Mouse}
  2. {Laptop, Mouse}
  3. {Keyboard}

.. admonition:: Solution (Click to reveal)
   :class: dropdown

   1. Support({Mouse}) = 4/5 = 80%
   2. Support({Laptop, Mouse}) = 2/5 = 40%
   3. Support({Keyboard}) = 3/5 = 60%

------------------------------------------------------------------------

Exercise 2: Calculate Confidence (Intermediate)
-----------------------------------------------

Using the same data as above:

**Question:** Calculate Confidence for {Laptop} ‚Üí {Mouse}

.. admonition:: Solution (Click to reveal)
   :class: dropdown

   Support({Laptop, Mouse}) = 2/5 = 0.4
   Support({Laptop}) = 3/5 = 0.6
   Confidence = (0.4) / (0.6) = 0.67 or 67%

------------------------------------------------------------------------

Exercise 3: Calculate Lift (Advanced)
-------------------------------------

**Question:** For the rule {Laptop} ‚Üí {Mouse}, calculate Lift.

.. admonition:: Solution (Click to reveal)
   :class: dropdown

   From above:  
   Support({Laptop, Mouse}) = 0.4  
   Support({Laptop}) = 0.6  
   Support({Mouse}) = 0.8  
   Lift = 0.4 / (0.6 √ó 0.8) = 0.83

------------------------------------------------------------------------

Exercise 4: Apply Apriori Algorithm (Challenge)
-----------------------------------------------

**Dataset:**

.. list-table::
   :header-rows: 1

   * - **Transaction**
     - **Items**
   * - T1
     - {A, B, C}
   * - T2
     - {A, B}
   * - T3
     - {A, C}
   * - T4
     - {B, C}
   * - T5
     - {A, B, C}
   * - T6
     - {A, C}

**Task:** Apply Apriori with **Minimum Support = 50%**
  1. All frequent 1-itemsets (L‚ÇÅ)
  2. All frequent 2-itemsets (L‚ÇÇ)
  3. Rules with **Confidence ‚â• 70%**
  4. Calculate Lift for each rule

.. admonition:: Complete Solution (Click to reveal)
   :class: dropdown

   L‚ÇÅ: {A} = 5/6 (83.33%), {B} = 4/6 (66.67%), {C} = 5/6 (83.33%)
   L‚ÇÇ: {A,B} = 3/6 (50%), {A,C} = 4/6 (66.67%), {B,C} = 3/6 (50%)

   Rules and Confidence:
   - {A}‚Üí{B}: 3/5 = 60%
   - {B}‚Üí{A}: 3/4 = 75% ‚úì
   - {A}‚Üí{C}: 4/5 = 80% ‚úì
   - {C}‚Üí{A}: 4/5 = 80% ‚úì
   - {B}‚Üí{C}: 3/4 = 75% ‚úì
   - {C}‚Üí{B}: 3/5 = 60%

   Lift Calculations (all with support fractions):
   - {B}‚Üí{A}: 0.5 / (0.667 √ó 0.833) = 0.9
   - {A}‚Üí{C}: 0.667 / (0.833 √ó 0.833) ‚âà 0.96
   - {C}‚Üí{A}: same as above
   - {B}‚Üí{C}: 0.5 / (0.667 √ó 0.833) = 0.9

   Conclusion: All these rules have Lift < 1 (not strong associations).

------------------------------------------------------------------------

.. tip::
   **Key Takeaways:**  
   - Use **support** for spotting popular items  
   - Use **confidence** for reliable recommendations  
   - Use **lift** for real, non-coincidental patterns  
   - The Apriori principle saves enormous time by pruning impossible patterns early!

========================================================================
